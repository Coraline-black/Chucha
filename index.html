<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ù–µ–º–æ–π —É–º–Ω—ã–π —Ä–æ–±–æ—Ç</title>
<style>
body {
  margin: 0;
  background: radial-gradient(#222, #000);
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
}

/* –†–æ–±–æ—Ç */
#robot {
  width: 220px;
  height: 320px;
  background: #444;
  border-radius: 30px;
  position: relative;
  box-shadow: 0 0 30px rgba(0,0,0,0.7);
}

/* –ì–ª–∞–∑–∞ */
.eye {
  width: 22px;
  height: 22px;
  background: white;
  border-radius: 50%;
  position: absolute;
  top: 70px;
  transition: all 0.3s;
}
.eye.left { left: 60px; }
.eye.right { right: 60px; }

/* –†—É–∫–∏ */
.arm {
  width: 20px;
  height: 100px;
  background: #555;
  position: absolute;
  top: 140px;
  border-radius: 10px;
  transition: transform 0.5s;
}
.arm.left { left: -15px; transform-origin: top right; }
.arm.right { right: -15px; transform-origin: top left; }

/* –ö–∞—Ä—Ç–æ–Ω–∫–∞ */
#card {
  position: absolute;
  top: -130px;
  left: 50%;
  transform: translateX(-50%);
  background: #d2b48c;
  padding: 18px 26px;
  border-radius: 12px;
  font-size: 28px;
  font-weight: bold;
  display: none;
  box-shadow: 0 10px 20px rgba(0,0,0,0.4);
  text-align: center;
  max-width: 180px;
  word-wrap: break-word;
}

/* –õ–∏—Ü–æ */
#face {
  position: absolute;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: 50px;
}

/* –ö–Ω–æ–ø–∫–∞ */
#listen {
  position: absolute;
  bottom: -70px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 22px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
}

/* –°—Ü–µ–Ω–∞ */
#scene {
  display: none;
  width: 150px;
  position: absolute;
  top: -150px;
  left: 50%;
  transform: translateX(-50%);
}
</style>
</head>
<body>

<div id="robot">
  <div class="eye left"></div>
  <div class="eye right"></div>

  <div class="arm left"></div>
  <div class="arm right"></div>

  <img id="face" src="https://i.pinimg.com/originals/4c/10/2e/4c102e2fdd68d3f2ad515a7ef44a9c8b.png" alt="Face">

  <div id="card"></div>
  <img id="scene" src="" alt="Scene">

  <button id="listen">üé§</button>
</div>

<script>
const card = document.getElementById("card");
const leftArm = document.querySelector(".arm.left");
const rightArm = document.querySelector(".arm.right");
const eyes = document.querySelectorAll(".eye");
const face = document.getElementById("face");
const scene = document.getElementById("scene");

/* –ü–∞–º—è—Ç—å —Ä–æ–±–æ—Ç–∞ */
let memory = JSON.parse(localStorage.getItem("robotMemory") || "[]");

/* –°–õ–£–• */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SpeechRecognition();
rec.lang = "ru-RU";

/* –ö–ù–û–ü–ö–ê */
document.getElementById("listen").onclick = () => {
  thinkAnimation();
  rec.start();
};

/* –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–ï */
rec.onresult = e => {
  const text = e.results[0][0].transcript.toLowerCase();
  console.log("–£—Å–ª—ã—à–∞–ª:", text);
  brain(text);
};

/* –í–ò–ó–£–ê–õ */
function showCard(text, time = 3000) {
  card.innerText = text;
  card.style.display = "block";
  raiseHands();
  setTimeout(() => {
    card.style.display = "none";
    resetPose();
  }, time);
}

function raiseHands() {
  leftArm.style.transform = "rotate(-60deg)";
  rightArm.style.transform = "rotate(60deg)";
}

function resetPose() {
  leftArm.style.transform = "rotate(0deg)";
  rightArm.style.transform = "rotate(0deg)";
}

function thinkAnimation() {
  eyes.forEach(e => e.style.transform = "scale(0.6)");
  setTimeout(() => eyes.forEach(e => e.style.transform = "scale(1)"), 800);
}

/* –ú–µ–Ω—è–µ–º –ª–∏—Ü–æ */
function changeFace(emotion) {
  const faces = {
    happy: "https://i.pinimg.com/originals/4c/10/2e/4c102e2fdd68d3f2ad515a7ef44a9c8b.png",
    sad: "https://i.pinimg.com/originals/35/33/13/35331317b10e6a8fa44c6f8655b36b18.png",
    surprised: "https://i.pinimg.com/originals/25/4b/ab/254bab80e51f6f450d7c6d3f5f95c456.png"
  };
  face.src = faces[emotion] || faces.happy;
}

/* –ü–æ–∫–∞–∑ —Å—Ü–µ–Ω—ã */
function showScene(name, time = 3000) {
  scene.src = name;
  scene.style.display = "block";
  setTimeout(() => scene.style.display = "none", time);
}

/* –ú–û–ó–ì */
function brain(text) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–º—è—Ç—å
  for (let i = 0; i < memory.length; i++) {
    if (text.includes(memory[i].question)) {
      if(memory[i].scene) showScene(memory[i].scene);
      if(memory[i].emotion) changeFace(memory[i].emotion);
      return showCard(memory[i].answer);
    }
  }

  let emotion = "happy";

  // –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê
  if (text.match(/\d+/g)) {
    let nums = text.match(/\d+/g).map(Number);
    if (text.includes("–ø–ª—é—Å")) return memorize(text, nums[0]+nums[1], emotion);
    if (text.includes("–º–∏–Ω—É—Å")) return memorize(text, nums[0]-nums[1], emotion);
    if (text.includes("—É–º–Ω–æ–∂")) return memorize(text, nums[0]*nums[1], emotion);
    if (text.includes("–¥–µ–ª")) return memorize(text, nums[0]/nums[1], emotion);
  }

  // –í–†–ï–ú–Ø
  if (text.includes("–≤—Ä–µ–º—è")) return memorize(text, new Date().toLocaleTimeString().slice(0,5), emotion);

  // –≠–ú–û–¶–ò–ò
  if (text.includes("–ø—Ä–∏–≤–µ—Ç")) { emotion="happy"; return memorize(text,"üëã",emotion); }
  if (text.includes("–ª—é–±")) { emotion="happy"; return memorize(text,"üíñ",emotion); }
  if (text.includes("–≥—Ä—É—Å—Ç")) { emotion="sad"; return memorize(text,"üòî",emotion); }
  if (text.includes("—Å—á–∞—Å—Ç")) { emotion="happy"; return memorize(text,"üòä",emotion); }

  // –í–û–ü–†–û–°–´ –û –°–ú–´–°–õ–ï
  if (text.includes("—á—Ç–æ —Ç–∞–∫–æ–µ")) { emotion="surprised"; return memorize(text,"üí°",emotion); }

  // –°–¶–ï–ù–´
  if (text.includes("–¥–æ–∂–¥—å")) { showScene("https://i.pinimg.com/originals/15/67/9e/15679e6f50c8b6c1f607fe7c8f7f6a1b.png"); emotion="surprised"; return memorize(text,"‚òî",emotion); }
  if (text.includes("—Å–æ–ª–Ω—Ü–µ")) { showScene("https://i.pinimg.com/originals/27/11/3a/27113a8e74f2e6b8d9bcd25f68e2d8c0.png"); emotion="happy"; return memorize(text,"‚òÄÔ∏è",emotion); }

  // –ï–°–õ–ò –ù–ï –ü–û–ù–Ø–õ
  emotion="surprised";
  memorize(text,"‚ùì",emotion);
}

/* –ü–∞–º—è—Ç—å */
function memorize(question, answer, emotion) {
  memory.push({question, answer, emotion});
  localStorage.setItem("robotMemory", JSON.stringify(memory));
  changeFace(emotion);
  return showCard(answer);
}
</script>

</body>
</html>
